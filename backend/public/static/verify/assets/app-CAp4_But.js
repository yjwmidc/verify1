import{M as I,a as pe,l as Se,b as Ce,c as xe,d as Ae,A as ze}from"./arco-1wC58RqX.js";import{r as g,c as V,j as d,k as A,l as h,m as a,u as l,z as y,w as re,o as ae,p as J,F as Q,S as ge,A as U,n as X,q as _e,ac as G,ah as Te}from"./vendor-yNFDUZVz.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const k of c.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&r(k)}).observe(document,{childList:!0,subtree:!0});function t(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(i){if(i.ep)return;i.ep=!0;const c=t(i);fetch(i.href,c)}})();function we(n){return function(t){return String(t||"")}}async function Ie(n,e){const t=await fetch(n,e);let r=null;try{r=await t.json()}catch{}return{res:t,data:r}}const Ee=we();function ke(n){return Object.prototype.toString.call(n)==="[object Object]"}function Le(n){const e=String(n||"get").toLowerCase();return e==="post"||e==="put"||e==="patch"||e==="delete"?e:"get"}function Ue(n){if(!n||!ke(n))return"";const e=new URLSearchParams;Object.keys(n).forEach(r=>{const i=n[r];if(!(typeof i>"u"||i===null)){if(Array.isArray(i)){i.forEach(c=>{typeof c>"u"||c===null||e.append(r,String(c))});return}e.set(r,String(i))}});const t=e.toString();return t?`?${t}`:""}function H(n){const e=n||{},t=Le(e.method),r=Object.assign({},e.headers||{}),i=Ee(String(e.url||"")),c=Ue(e.params),k=c?i.includes("?")?`${i}&${c.slice(1)}`:`${i}${c}`:i,m={method:t.toUpperCase(),headers:r};if(t!=="get"){const x=e.data;if(typeof x<"u")if(x instanceof FormData||typeof x=="string")m.body=x;else if(ke(x)||Array.isArray(x))if(!("Content-Type"in r)&&!("content-type"in r)&&(m.headers=Object.assign({},r,{"Content-Type":"application/json"})),String(m.headers&&(m.headers["Content-Type"]||m.headers["content-type"])||"").includes("application/x-www-form-urlencoded")){const S=new URLSearchParams;Object.keys(x||{}).forEach(_=>{const f=x[_];if(!(typeof f>"u"||f===null)){if(Array.isArray(f)){f.forEach(E=>{typeof E>"u"||E===null||S.append(_,String(E))});return}S.set(_,String(f))}}),m.body=S.toString()}else m.body=JSON.stringify(x);else m.body=String(x)}return Ie(k,m)}function Pe(n){return H({url:"/admin/settings",method:"get",headers:{Authorization:"Bearer "+String(n||"")}})}function Ve(n,e){return H({url:"/admin/settings",method:"put",headers:{Authorization:"Bearer "+String(n||"")},data:{values:e||{}}})}function be(n){return H({url:"/admin/dashboard",method:"get",headers:{Authorization:"Bearer "+String(n||"")}})}function Ne(n){try{return localStorage.getItem(n)||""}catch{return""}}function Ke(n,e){try{localStorage.setItem(n,e)}catch{}}function $e(n){try{localStorage.removeItem(n)}catch{}}const me="admin_access_token";function Oe(){return Ne(me)}function Me(n){Ke(me,String(n||""))}function De(){$e(me)}const ie=(n,e)=>{const t=n.__vccOpts||n;for(const[r,i]of e)t[r]=i;return t},je={__name:"index",props:{onLoginSuccess:{type:Function,default:null}},setup(n){const e=n,t=g(""),r=g(!1),i=g("");function c(S){const _=S?String(S):"";Me(_)}async function k(S){i.value="",r.value=!0;try{const _=String(S||"").trim();if(!_)return i.value="请输入 API_KEY",!1;const{data:f}=await be(_);return f&&f.code===0?(c(_),!0):(i.value=f&&f.msg||"登录失败",!1)}catch{return i.value="网络异常，请稍后重试",!1}finally{r.value=!1}}const m=V(()=>r.value),x=V(()=>i.value||"");async function N(){const S=String(t.value||"").trim();!S||!await k(S)||(t.value="",e.onLoginSuccess&&e.onLoginSuccess())}return(S,_)=>{const f=d("a-result"),E=d("a-alert"),P=d("a-input-password"),O=d("a-form-item"),B=d("a-form"),Y=d("a-button"),K=d("a-space"),$=d("a-spin"),R=d("a-card");return h(),A(R,{title:"管理后台",class:"card"},{default:a(()=>[l($,{loading:m.value,style:{width:"100%"}},{default:a(()=>[x.value?(h(),A(f,{key:0,status:"error",title:"加载失败",subtitle:x.value},null,8,["subtitle"])):(h(),A(K,{key:1,direction:"vertical",size:"medium",fill:""},{default:a(()=>[l(E,{type:"info","show-icon":!0,title:"登录说明"},{default:a(()=>[..._[1]||(_[1]=[y("输入默认 API_KEY 登录。",-1)])]),_:1}),l(B,{layout:"vertical"},{default:a(()=>[l(O,{label:"API_KEY"},{default:a(()=>[l(P,{modelValue:t.value,"onUpdate:modelValue":_[0]||(_[0]=b=>t.value=b),placeholder:"请输入默认 API_KEY","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),l(Y,{type:"primary",long:"",loading:m.value,onClick:N},{default:a(()=>[..._[2]||(_[2]=[y("登录",-1)])]),_:1},8,["loading"])]),_:1}))]),_:1},8,["loading"])]),_:1})}}},Fe=ie(je,[["__scopeId","data-v-2f573779"]]),Be={__name:"index",props:{token:{type:String,default:""},onUnauthorized:{type:Function,default:null}},setup(n){const e=n,t=V(()=>String(e.token||"")),r=g([]),i=g(!1),c=g("");function k(){r.value=[],c.value=""}function m(){k(),e.onUnauthorized&&e.onUnauthorized()}async function x(){c.value="",i.value=!0;try{const u=t.value?String(t.value):"";if(!u)return!1;const{data:p}=await Pe(u);return p&&p.code===0&&p.data&&Array.isArray(p.data.items)?(r.value=p.data.items,!0):p&&p.code===401?(m(),c.value="登录已过期，请重新登录",!1):(c.value=p&&p.msg||"加载失败",!1)}catch{return c.value="网络异常，请稍后重试",!1}finally{i.value=!1}}async function N(u){c.value="",i.value=!0;try{const p=t.value?String(t.value):"";if(!p)return c.value="请先登录",{ok:!1,unauthorized:!0};const{data:C}=await Ve(p,u||{});return C&&C.code===0&&C.data&&Array.isArray(C.data.items)?(r.value=C.data.items,{ok:!0,unauthorized:!1}):C&&C.code===401?(m(),c.value="登录已过期，请重新登录",{ok:!1,unauthorized:!0}):(c.value=C&&C.msg||"保存失败",{ok:!1,unauthorized:!1})}catch{return c.value="网络异常，请稍后重试",{ok:!1,unauthorized:!1}}finally{i.value=!1}}const S=V(()=>i.value),_=V(()=>c.value||""),f=g({}),E={GEETEST_CAPTCHA_ID:{name:"极验 CAPTCHA ID",help:"用于前端初始化极验验证码，从极验后台获取。"},GEETEST_CAPTCHA_KEY:{name:"极验 CAPTCHA KEY",help:"用于服务端校验的密钥，务必妥善保管。"},API_KEY:{name:"管理后台 API_KEY",help:"用于登录管理后台；支持多个密钥，用逗号/空格/换行分隔；每个密钥建议至少 16 位。"},ADMIN_JWT_SECRET:{name:"管理员 JWT 签名密钥",help:"用于签发/校验管理 Token；修改后旧 Token 会失效。"},SALT:{name:"系统 SALT",help:"用于安全相关的签名/校验；修改可能影响历史数据的校验结果。"}};function P(u){return["GEETEST_CAPTCHA_KEY","API_KEY","SALT","ADMIN_JWT_SECRET"].includes(String(u||""))}function O(u){const p=String(u&&u.key?u.key:""),C=E[p];return C&&C.name?C.name:(u&&u.label?String(u.label):"")||p||"未知字段"}function B(u){const p=String(u&&u.key?u.key:""),C=E[p],M=C&&C.help?C.help:"只填写需要修改的项，留空不会覆盖已有配置。",W=u&&u.source?String(u.source):"-",j=u&&u.is_set?"已设置":"未设置";return`${M}（字段：${p||"-"}，来源：${W}，${j}）`}const Y=V(()=>(r.value||[]).filter(u=>String(u.key||"").startsWith("GEETEST_"))),K=V(()=>(r.value||[]).filter(u=>!String(u.key||"").startsWith("GEETEST_")));function $(u){const p={};(u||[]).forEach(C=>{p[String(C.key)]=""}),f.value=p}re(()=>r.value,u=>$(u),{immediate:!0});const R=V(()=>{const u=f.value||{};return Object.keys(u).some(p=>String(u[p]||"").trim()!=="")});async function b(){const u={};Object.keys(f.value||{}).forEach(C=>{const M=String(f.value[C]||"").trim();M!==""&&(u[C]=M)}),(await N(u)).ok&&(I.success("保存成功"),$(r.value))}return ae(()=>{t.value&&x()}),(u,p)=>{const C=d("a-alert"),M=d("a-result"),W=d("a-input-password"),j=d("a-input"),q=d("a-form-item"),T=d("a-form"),o=d("a-tab-pane"),s=d("a-tabs"),v=d("a-button"),w=d("a-space");return h(),A(w,{direction:"vertical",size:"medium",fill:""},{default:a(()=>[l(C,{type:"info","show-icon":!0},{default:a(()=>[...p[0]||(p[0]=[y("只填写需要修改的项，留空不会覆盖已有配置。",-1)])]),_:1}),_.value?(h(),A(M,{key:0,status:"error",title:"加载失败",subtitle:_.value},null,8,["subtitle"])):(h(),J(Q,{key:1},[l(s,{"default-active-key":"geetest",type:"rounded"},{default:a(()=>[l(o,{key:"geetest",title:"验证码配置"},{default:a(()=>[l(T,{layout:"vertical"},{default:a(()=>[(h(!0),J(Q,null,ge(Y.value,L=>(h(),A(q,{key:L.key,label:O(L)},{help:a(()=>[y(U(B(L)),1)]),default:a(()=>[P(L.key)?(h(),A(W,{key:0,modelValue:f.value[L.key],"onUpdate:modelValue":D=>f.value[L.key]=D,placeholder:L.masked||"","allow-clear":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(h(),A(j,{key:1,modelValue:f.value[L.key],"onUpdate:modelValue":D=>f.value[L.key]=D,placeholder:String(L.value||""),"allow-clear":""},null,8,["modelValue","onUpdate:modelValue","placeholder"]))]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),l(o,{key:"security",title:"安全与密钥"},{default:a(()=>[l(T,{layout:"vertical"},{default:a(()=>[(h(!0),J(Q,null,ge(K.value,L=>(h(),A(q,{key:L.key,label:O(L)},{help:a(()=>[y(U(B(L)),1)]),default:a(()=>[l(W,{modelValue:f.value[L.key],"onUpdate:modelValue":D=>f.value[L.key]=D,placeholder:L.masked||"","allow-clear":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1})]),_:1}),l(w,{direction:"vertical",size:"medium",fill:""},{default:a(()=>[l(w,null,{default:a(()=>[l(v,{loading:S.value,onClick:x},{default:a(()=>[...p[1]||(p[1]=[y("刷新",-1)])]),_:1},8,["loading"]),l(v,{type:"primary",loading:S.value,disabled:!R.value,onClick:b},{default:a(()=>[...p[2]||(p[2]=[y("保存更改",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})],64))]),_:1})}}};function ne(n){return{Authorization:"Bearer "+String(n||"")}}function Re(n){return H({url:"/admin/api-keys",method:"get",headers:ne(n)})}function We(n,e){const t=Number(e||0),r=Number.isFinite(t)&&t>0?{id:Math.floor(t)}:void 0;return H({url:"/admin/api-keys",method:"get",headers:ne(n),params:r})}function Ye(n,e){const t=typeof e>"u"?"":String(e||"").trim(),r=t?{value:t}:{};return H({url:"/admin/api-keys",method:"post",headers:ne(n),data:r})}function Ge(n,e){return H({url:`/admin/api-keys/${Number(e)}`,method:"delete",headers:ne(n)})}function He(n,e){return H({url:`/admin/api-keys/${Number(e)}/reset`,method:"post",headers:ne(n)})}const qe={__name:"index",props:{token:{type:String,default:""},onUnauthorized:{type:Function,default:null}},setup(n){const e=n,t=V(()=>String(e.token||"")),r=g(!1),i=g(""),c=g([]),k=g(""),m=g(0),x=g(!1),N=g("random"),S=g(""),_=g(!1),f=g(""),E=g(0),P=g("create"),O=V(()=>P.value==="reset"?"密钥重置成功":"密钥创建成功"),B=V(()=>P.value==="reset"?"下面是重置后的新密钥原文（仅展示一次），请立即复制保存：":"下面是新建密钥原文（仅展示一次），请立即复制保存："),Y=[{title:"ID",dataIndex:"id",width:90},{title:"密钥",width:180,dataIndex:"masked"},{title:"类型",width:120,slotName:"type"},{title:"创建时间",width:180,slotName:"createdAt"},{title:"更新时间",width:180,slotName:"updatedAt"},{title:"操作",width:200,slotName:"actions"}];function K(o){const s=Number(o||0);if(!s)return"-";try{return new Date(s*1e3).toLocaleString("zh-CN",{hour12:!1})}catch{return String(s)}}async function $(){i.value="",r.value=!0;try{const o=t.value?String(t.value):"";if(!o)return e.onUnauthorized&&e.onUnauthorized(),i.value="登录已过期，请重新登录",!1;const s=Number(m.value||0),{data:v}=s>0?await We(o,s):await Re(o);return v&&v.code===0&&v.data&&Array.isArray(v.data.items)?(c.value=v.data.items,!0):v&&v.code===401?(e.onUnauthorized&&e.onUnauthorized(),i.value="登录已过期，请重新登录",!1):(i.value=v&&v.msg||"加载失败",!1)}catch{return i.value="网络异常，请稍后重试",!1}finally{r.value=!1}}function R(o){const s=String(o||"").trim();if(!s)return 0;if(!/^\d+$/.test(s))return-1;const v=Number(s);return!Number.isFinite(v)||v<=0?-1:Math.floor(v)}async function b(){const o=R(k.value);if(o===-1){I.error("请输入正确的 ID");return}m.value=o,await $()}async function u(){k.value="",m.value=0,await $()}async function p(){await $()}function C(o){N.value=o==="manual"?"manual":"random",S.value="",x.value=!0}async function M(){r.value=!0;try{const o=t.value?String(t.value):"";if(!o){e.onUnauthorized&&e.onUnauthorized(),I.error("登录已过期，请重新登录"),x.value=!1;return}const s=N.value==="manual"?String(S.value||"").trim():void 0,{data:v}=await Ye(o,s||void 0);if(v&&v.code===0&&v.data&&v.data.value){x.value=!1,P.value="create",E.value=Number(v.data.id||0)||0,f.value=String(v.data.value),_.value=!0,await $();return}if(v&&v.code===401){e.onUnauthorized&&e.onUnauthorized(),I.error("登录已过期，请重新登录"),x.value=!1;return}I.error(v&&v.msg||"创建失败")}catch{I.error("网络异常，请稍后重试")}finally{r.value=!1}}function W(){_.value=!1,f.value="",P.value="create",E.value=0}async function j(){const o=String(f.value||"");if(o)try{await navigator.clipboard.writeText(o),I.success("已复制")}catch{I.error("复制失败，请手动复制")}}function q(o){const s=o&&o.id?Number(o.id):0;s&&(o&&o.is_default||pe.confirm({title:"确认删除",content:`删除后该密钥将立即失效（ID：${s}）。`,okText:"删除",cancelText:"取消",okButtonProps:{status:"danger"},onOk:async()=>{r.value=!0;try{const v=t.value?String(t.value):"";if(!v){e.onUnauthorized&&e.onUnauthorized(),I.error("登录已过期，请重新登录");return}const{data:w}=await Ge(v,s);if(w&&w.code===0){I.success("删除成功"),await $();return}if(w&&w.code===401){e.onUnauthorized&&e.onUnauthorized(),I.error("登录已过期，请重新登录");return}I.error(w&&w.msg||"删除失败")}catch{I.error("网络异常，请稍后重试")}finally{r.value=!1}}}))}function T(o){const s=o&&o.id?Number(o.id):0;s&&pe.confirm({title:"确认重置",content:`将替换该密钥的值，旧密钥将立即失效（ID：${s}）。`,okText:"重置",cancelText:"取消",okButtonProps:{status:"warning"},onOk:async()=>{r.value=!0;try{const v=t.value?String(t.value):"";if(!v){e.onUnauthorized&&e.onUnauthorized(),I.error("登录已过期，请重新登录");return}const{data:w}=await He(v,s);if(w&&w.code===0&&w.data&&w.data.value){const L=Number(w.data.id||0)||0;if(L&&L!==s){I.error(`重置接口返回的 ID 异常：期望 ${s}，实际 ${L}`);return}P.value="reset",E.value=s,f.value=String(w.data.value),_.value=!0,I.success("重置成功"),await $();return}if(w&&w.code===401){e.onUnauthorized&&e.onUnauthorized(),I.error("登录已过期，请重新登录");return}I.error(w&&w.msg||"重置失败")}catch{I.error("网络异常，请稍后重试")}finally{r.value=!1}}})}return re(()=>t.value,o=>{o?$():c.value=[]},{immediate:!0}),re(()=>k.value,o=>{String(o||"").trim()===""&&m.value&&(m.value=0,$())}),ae(()=>{t.value&&$()}),(o,s)=>{const v=d("a-alert"),w=d("a-button"),L=d("a-input"),D=d("a-space"),Z=d("a-typography-text"),se=d("a-result"),ue=d("a-table"),oe=d("a-input-password"),ce=d("a-form-item"),le=d("a-form"),F=d("a-typography-paragraph"),te=d("a-modal");return h(),A(D,{direction:"vertical",size:"medium",fill:""},{default:a(()=>[l(v,{type:"warning","show-icon":!0},{default:a(()=>[...s[7]||(s[7]=[y("列表仅显示脱敏值；新建/重置密钥只会在弹窗里展示一次，请及时保存。",-1)])]),_:1}),l(D,{align:"center",justify:"space-between",fill:""},{default:a(()=>[l(D,null,{default:a(()=>[l(w,{loading:r.value,onClick:p},{default:a(()=>[...s[8]||(s[8]=[y("刷新",-1)])]),_:1},8,["loading"]),l(w,{type:"primary",loading:r.value,onClick:s[0]||(s[0]=z=>C("random"))},{default:a(()=>[...s[9]||(s[9]=[y("新增随机密钥",-1)])]),_:1},8,["loading"]),l(w,{loading:r.value,onClick:s[1]||(s[1]=z=>C("manual"))},{default:a(()=>[...s[10]||(s[10]=[y("新增自定义密钥",-1)])]),_:1},8,["loading"]),l(L,{modelValue:k.value,"onUpdate:modelValue":s[2]||(s[2]=z=>k.value=z),placeholder:"按 ID 查询","allow-clear":"",style:{width:"160px"},onPressEnter:b},null,8,["modelValue"]),l(w,{loading:r.value,onClick:b},{default:a(()=>[...s[11]||(s[11]=[y("查询",-1)])]),_:1},8,["loading"]),l(w,{loading:r.value,disabled:!m.value,onClick:u},{default:a(()=>[...s[12]||(s[12]=[y("清空",-1)])]),_:1},8,["loading","disabled"])]),_:1}),l(Z,{type:"secondary"},{default:a(()=>[y(" 共 "+U((c.value||[]).length)+" 个"+U(m.value?`（ID：${m.value}）`:""),1)]),_:1})]),_:1}),i.value?(h(),A(se,{key:0,status:"error",title:"加载失败",subtitle:i.value},null,8,["subtitle"])):(h(),A(ue,{key:1,columns:Y,data:c.value,loading:r.value,pagination:!1,"row-key":"id",size:"medium"},{type:a(({record:z})=>[X("span",null,U(z&&z.is_default?"当前使用":"普通"),1)]),createdAt:a(({record:z})=>[X("span",null,U(K(z&&z.created_at)),1)]),updatedAt:a(({record:z})=>[X("span",null,U(K(z&&z.updated_at)),1)]),actions:a(({record:z})=>[l(D,null,{default:a(()=>[l(w,{status:"warning",size:"mini",loading:r.value,onClick:de=>T(z)},{default:a(()=>[...s[13]||(s[13]=[y(" 重置 ",-1)])]),_:1},8,["loading","onClick"]),l(w,{status:"danger",size:"mini",loading:r.value,disabled:z&&z.is_default,onClick:de=>q(z)},{default:a(()=>[...s[14]||(s[14]=[y(" 删除 ",-1)])]),_:1},8,["loading","disabled","onClick"])]),_:2},1024)]),_:1},8,["data","loading"])),l(te,{visible:x.value,"onUpdate:visible":s[4]||(s[4]=z=>x.value=z),title:N.value==="manual"?"新增自定义密钥":"新增随机密钥","mask-closable":!1,"ok-loading":r.value,onOk:M},{default:a(()=>[l(D,{direction:"vertical",size:"medium",fill:""},{default:a(()=>[N.value==="manual"?(h(),A(le,{key:0,layout:"vertical"},{default:a(()=>[l(ce,{label:"密钥"},{default:a(()=>[l(oe,{modelValue:S.value,"onUpdate:modelValue":s[3]||(s[3]=z=>S.value=z),placeholder:"至少 16 位，建议随机强口令","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1})):(h(),A(F,{key:1,style:{margin:"0"}},{default:a(()=>[...s[15]||(s[15]=[y(" 将自动生成一个高强度随机密钥。 ",-1)])]),_:1}))]),_:1})]),_:1},8,["visible","title","ok-loading"]),l(te,{visible:_.value,"onUpdate:visible":s[6]||(s[6]=z=>_.value=z),title:O.value,"mask-closable":!1,footer:!1},{default:a(()=>[l(D,{direction:"vertical",size:"medium",fill:""},{default:a(()=>[l(F,{style:{margin:"0"}},{default:a(()=>[y(U(B.value),1)]),_:1}),E.value?(h(),A(Z,{key:0,type:"secondary"},{default:a(()=>[y("ID："+U(E.value),1)]),_:1})):_e("",!0),l(L,{modelValue:f.value,"onUpdate:modelValue":s[5]||(s[5]=z=>f.value=z),readonly:""},null,8,["modelValue"]),l(D,null,{default:a(()=>[l(w,{type:"primary",onClick:j},{default:a(()=>[...s[16]||(s[16]=[y("复制",-1)])]),_:1}),l(w,{onClick:W},{default:a(()=>[...s[17]||(s[17]=[y("关闭",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["visible","title"])]),_:1})}}},Je={__name:"index",props:{onLogout:{type:Function,default:null}},setup(n){const e=n,t=g(Oe()),r=V(()=>!!t.value),i=g(!1),c=g("");function k(T){const o="";t.value=o,De()}function m(){k(),c.value=""}const x=we(),N=V(()=>i.value),S=V(()=>c.value?c.value:""),_=V(()=>String(t.value||"")),f=V(()=>{try{const T=x("/_ping_");return!T||T.startsWith("/")?"":new URL(T).origin}catch{return""}}),E=g("overview"),P=g(!1),O=g(""),B=g(0),Y=V(()=>u(B.value)),K=g({now:0,api_keys_total:0,tickets_total:0,tickets_verified_total:0,tickets_used_total:0,tickets_pending:0,tickets_expired_total:0,calls_24h_total:0,calls_24h_error:0,calls_24h_by_endpoint:[],calls_24h_top_groups:[],recent_calls:[]}),$=[{title:"Endpoint",dataIndex:"endpoint"},{title:"次数",dataIndex:"count",width:90}],R=[{title:"群号",dataIndex:"group_id"},{title:"次数",dataIndex:"count",width:90}],b=[{title:"时间",width:180,slotName:"createdAt"},{title:"Endpoint",dataIndex:"endpoint",width:180},{title:"方法",dataIndex:"method",width:90},{title:"状态",dataIndex:"status_code",width:90},{title:"群号",dataIndex:"group_id",width:120},{title:"用户",dataIndex:"user_id",width:120},{title:"KeyID",dataIndex:"api_key_id",width:90},{title:"耗时(ms)",dataIndex:"duration_ms",width:110}];function u(T){const o=Number(T||0);if(!o)return"";try{return new Date(o*1e3).toLocaleString("zh-CN",{hour12:!1})}catch{return String(o)}}async function p(){O.value="",P.value=!0;try{const T=_.value?String(_.value):"";if(!T)return j(),O.value="登录已过期，请重新登录",!1;const{data:o}=await be(T);return o&&o.code===0&&o.data?(K.value={...K.value,...o.data},B.value=Number(o.data.now||0)||Math.floor(Date.now()/1e3),!0):o&&o.code===401?(j(),O.value="登录已过期，请重新登录",!1):(O.value=o&&o.msg||"加载失败",!1)}catch{return O.value="网络异常，请稍后重试",I.error(O.value),!1}finally{P.value=!1}}function C(){try{const T=new URL(window.location.href),o=String(T.searchParams.get("page")||"");return o==="settings"?"settings":o==="apiKeys"?"apiKeys":"overview"}catch{return"overview"}}function M(T){try{const o=new URL(window.location.href);T==="settings"?o.searchParams.set("page","settings"):T==="apiKeys"?o.searchParams.set("page","apiKeys"):o.searchParams.delete("page"),window.history.pushState({},"",o.pathname+o.search+o.hash)}catch{}}function W(T){const o=T==="settings"?"settings":T==="apiKeys"?"apiKeys":"overview";E.value=o,M(o)}function j(){m(),e.onLogout&&e.onLogout()}function q(){m(),e.onLogout&&e.onLogout()}return ae(()=>{if(r.value){E.value=C(),window.addEventListener("popstate",()=>{E.value=C()}),E.value==="overview"&&p();return}e.onLogout&&e.onLogout()}),re(E,T=>{T==="overview"&&r.value&&p()}),(T,o)=>{const s=d("a-typography-title"),v=d("a-tag"),w=d("a-space"),L=d("a-button"),D=d("a-layout-header"),Z=d("a-menu-item"),se=d("a-menu"),ue=d("a-layout-sider"),oe=d("a-result"),ce=d("a-alert"),le=d("a-typography-text"),F=d("a-card"),te=d("a-grid"),z=d("a-table"),de=d("a-layout-content"),ve=d("a-layout");return h(),A(ve,{class:"layout"},{default:a(()=>[l(D,{class:"header"},{default:a(()=>[l(w,{align:"center",justify:"space-between",fill:""},{default:a(()=>[l(w,{align:"center"},{default:a(()=>[l(s,{heading:5,style:{margin:"0"}},{default:a(()=>[...o[0]||(o[0]=[y("管理后台",-1)])]),_:1}),f.value?(h(),A(v,{key:0,color:"blue"},{default:a(()=>[y("API："+U(f.value),1)]),_:1})):_e("",!0),l(v,{color:"green"},{default:a(()=>[...o[1]||(o[1]=[y("已登录",-1)])]),_:1})]),_:1}),l(L,{status:"danger",disabled:N.value,onClick:q},{default:a(()=>[...o[2]||(o[2]=[y("退出",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),l(ve,null,{default:a(()=>[l(ue,{class:"sider",width:200,breakpoint:"lg",collapsible:""},{default:a(()=>[l(se,{"selected-keys":[E.value],onMenuItemClick:W},{default:a(()=>[l(Z,{key:"overview"},{default:a(()=>[...o[3]||(o[3]=[y("概览",-1)])]),_:1}),l(Z,{key:"apiKeys"},{default:a(()=>[...o[4]||(o[4]=[y("API Key 管理",-1)])]),_:1}),l(Z,{key:"settings"},{default:a(()=>[...o[5]||(o[5]=[y("配置管理",-1)])]),_:1})]),_:1},8,["selected-keys"])]),_:1}),l(de,{class:"content"},{default:a(()=>[S.value?(h(),A(oe,{key:0,status:"error",title:"加载失败",subtitle:S.value},null,8,["subtitle"])):(h(),J(Q,{key:1},[E.value==="overview"?(h(),A(F,{key:0,title:"概览",class:"card"},{default:a(()=>[l(w,{direction:"vertical",size:"medium",fill:""},{default:a(()=>[l(ce,{type:"info","show-icon":!0,title:"提示"},{default:a(()=>[...o[6]||(o[6]=[y("从左侧进入“API Key 管理 / 配置管理”维护密钥与验证码配置。",-1)])]),_:1}),l(w,{align:"center",justify:"space-between",fill:""},{default:a(()=>[l(w,null,{default:a(()=>[l(L,{loading:P.value,onClick:p},{default:a(()=>[...o[7]||(o[7]=[y("刷新概览",-1)])]),_:1},8,["loading"])]),_:1}),l(le,{type:"secondary"},{default:a(()=>[y(U(Y.value?`更新时间：${Y.value}`:""),1)]),_:1})]),_:1}),O.value?(h(),A(oe,{key:0,status:"error",title:"概览加载失败",subtitle:O.value},null,8,["subtitle"])):(h(),J(Q,{key:1},[l(te,{cols:3,"col-gap":16,"row-gap":16},{default:a(()=>[l(F,{title:"API Key 数量",loading:P.value},{default:a(()=>[l(s,{heading:4,style:{margin:"0"}},{default:a(()=>[y(U(K.value.api_keys_total),1)]),_:1})]),_:1},8,["loading"]),l(F,{title:"验证票据总数",loading:P.value},{default:a(()=>[l(s,{heading:4,style:{margin:"0"}},{default:a(()=>[y(U(K.value.tickets_total),1)]),_:1})]),_:1},8,["loading"]),l(F,{title:"24h API 调用",loading:P.value},{default:a(()=>[l(s,{heading:4,style:{margin:"0"}},{default:a(()=>[y(U(K.value.calls_24h_total),1)]),_:1}),l(le,{type:"secondary"},{default:a(()=>[y("错误："+U(K.value.calls_24h_error),1)]),_:1})]),_:1},8,["loading"])]),_:1}),l(te,{cols:2,"col-gap":16,"row-gap":16},{default:a(()=>[l(F,{title:"24h Endpoint Top",loading:P.value},{default:a(()=>[l(z,{columns:$,data:K.value.calls_24h_by_endpoint,pagination:!1,"row-key":"endpoint",size:"small"},null,8,["data"])]),_:1},8,["loading"]),l(F,{title:"24h 群 Top",loading:P.value},{default:a(()=>[l(z,{columns:R,data:K.value.calls_24h_top_groups,pagination:!1,"row-key":"group_id",size:"small"},null,8,["data"])]),_:1},8,["loading"])]),_:1}),l(F,{title:"最近 20 条调用",loading:P.value},{default:a(()=>[l(z,{columns:b,data:K.value.recent_calls,pagination:!1,"row-key":"id",size:"small"},{createdAt:a(({record:ye})=>[X("span",null,U(u(ye&&ye.created_at)),1)]),_:1},8,["data"])]),_:1},8,["loading"])],64))]),_:1})]),_:1})):E.value==="apiKeys"?(h(),A(F,{key:1,title:"API Key 管理",class:"card"},{default:a(()=>[l(qe,{token:_.value,"on-unauthorized":j},null,8,["token"])]),_:1})):(h(),A(F,{key:2,title:"配置管理",class:"card"},{default:a(()=>[l(Be,{token:_.value,"on-unauthorized":j},null,8,["token"])]),_:1}))],64))]),_:1})]),_:1})]),_:1})}}},Qe=ie(Je,[["__scopeId","data-v-1aba6a8b"]]);async function he(n){if(navigator.clipboard&&window.isSecureContext){await navigator.clipboard.writeText(n);return}const e=document.createElement("textarea");e.value=n,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select();const t=document.execCommand("copy");if(document.body.removeChild(e),!t)throw new Error("copy failed")}function Xe(n){const e=new URLSearchParams;return Object.keys(n||{}).forEach(t=>e.append(t,n[t]==null?"":String(n[t]))),e.toString()}function Ze(){const n=window.location.pathname||"",e=window.location.hash||"";return n.startsWith("/admin")||e.startsWith("#/admin")}function et(){const n=window.location.search||"",t=new URLSearchParams(n).get("ticket");if(t)return t;const i=(window.location.pathname||"").match(/\/v\/([^/?#]+)/);if(i&&i[1])return decodeURIComponent(i[1]);const k=(window.location.hash||"").match(/#\/v\/([^/?#]+)/);return k&&k[1]?decodeURIComponent(k[1]):""}function tt(n){return H({url:"/verify/status/"+encodeURIComponent(String(n||"")),method:"get"})}function at(n){return H({url:"/verify/callback",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:String(n||"")})}const nt={class:"code"},ot={__name:"index",props:{t:{type:Function,default:n=>String(n||"")}},setup(n){const t=n.t,r=g(""),i=g(!0),c=g(""),k=g(!1),m=g(""),x=g(""),N=g(null),S=g(!1),_=g(!1);let f=null;const E=V(()=>k.value?t("title_success"):t("title_default")),P=V(()=>N.value?t("expire_tip",{minutes:N.value}):"");function O(){c.value=t("link_expired_or_missing"),k.value=!1,m.value="",N.value=null}function B(){if(!x.value)return;if(typeof window.initGeetest4>"u"){c.value=t("captcha_component_load_failed"),S.value=!1;return}S.value=!1,f=null;const b=document.querySelector("#captcha");b&&(b.innerHTML=""),window.initGeetest4({captchaId:x.value,product:"bind",language:"zh-cn",timeout:1e4},u=>{f=u;try{u.appendTo("#captcha")}catch{}u.onReady(()=>{S.value=!0}).onError(()=>{c.value=t("captcha_init_failed"),S.value=!1}).onSuccess(()=>{const p=f&&f.getValidate?f.getValidate():null;if(!p){I.error(t("please_complete_captcha"));return}K(p)}).onClose(()=>{_.value=!1})})}function Y(){if(!S.value||!f){I.warning(t("captcha_loading_wait"));return}try{f.showCaptcha()}catch{I.error(t("captcha_error_refresh"))}}async function K(b){_.value=!0;try{const{data:u}=await at(Xe({ticket:r.value,lot_number:b.lot_number,captcha_output:b.captcha_output,pass_token:b.pass_token,gen_time:b.gen_time}));if(u&&u.code===0&&u.data&&u.data.code){k.value=!0,m.value=String(u.data.code),I.success(t("verify_success"));try{await he(m.value),I.success(t("code_copied_paste"))}catch{}return}if(I.error(u&&u.msg||t("verify_failed_retry")),_.value=!1,f)try{f.reset()}catch{}}catch{I.error(t("network_error_retry")),_.value=!1}}async function $(){if(m.value)try{await he(m.value),I.success(t("code_copied"))}catch{pe.info({title:t("copy_failed"),content:t("copy_failed_manual_prefix")+m.value,hideCancel:!0})}}async function R(){i.value=!0,c.value="";try{const{data:b}=await tt(r.value);if(!b||typeof b.code>"u"){c.value=t("server_response_invalid");return}if(b.code===404){O();return}if(b.code!==0){c.value=b.msg||t("load_failed");return}const u=b.data&&typeof b.data.expire_minutes<"u"?Number(b.data.expire_minutes):null;if(N.value=Number.isFinite(u)&&u>0?Math.ceil(u):null,b.data&&b.data.verified){k.value=!0,m.value=String(b.data.code||"");return}k.value=!1,m.value="",x.value=b.data&&b.data.captcha_id||"",B()}catch{c.value="网络异常，请稍后重试"}finally{i.value=!1}}return ae(()=>{if(r.value=et(),!r.value){i.value=!1,c.value=t("invalid_link");return}R()}),(b,u)=>{const p=d("a-result"),C=d("a-typography-paragraph"),M=d("a-button"),W=d("a-space"),j=d("a-spin"),q=d("a-card");return h(),A(q,{title:E.value,class:"card"},{default:a(()=>[l(j,{loading:i.value,style:{width:"100%"}},{default:a(()=>[c.value?(h(),A(p,{key:0,status:"error",title:G(t)("load_failed"),subtitle:c.value},null,8,["title","subtitle"])):(h(),J(Q,{key:1},[k.value?(h(),A(p,{key:0,status:"success",title:G(t)("title_success"),subtitle:G(t)("verify_success_subtitle")},{extra:a(()=>[X("div",nt,U(m.value),1),N.value?(h(),A(C,{key:0,style:{margin:"12px 0 0","text-align":"center"}},{default:a(()=>[y(U(P.value),1)]),_:1})):_e("",!0),l(W,{direction:"vertical",size:"medium",fill:"",style:{"margin-top":"16px"}},{default:a(()=>[l(M,{type:"primary",long:"",onClick:$},{default:a(()=>[y(U(G(t)("copy_code")),1)]),_:1}),l(M,{long:"",onClick:R},{default:a(()=>[y(U(G(t)("refresh_status")),1)]),_:1})]),_:1})]),_:1},8,["title","subtitle"])):(h(),J(Q,{key:1},[l(C,{style:{"margin-top":"0","margin-bottom":"12px","white-space":"pre-line"}},{default:a(()=>[y(U(G(t)("steps")),1)]),_:1}),u[0]||(u[0]=X("div",{id:"captcha",class:"captcha-container"},null,-1)),l(W,{direction:"vertical",size:"medium",fill:""},{default:a(()=>[l(M,{type:"primary",long:"",loading:_.value,disabled:_.value||!S.value,onClick:Y},{default:a(()=>[y(U(S.value?G(t)("start_verify"):G(t)("captcha_loading")),1)]),_:1},8,["loading","disabled"]),l(M,{long:"",disabled:_.value,onClick:R},{default:a(()=>[y(U(G(t)("refresh_status")),1)]),_:1},8,["disabled"])]),_:1})],64))],64))]),_:1},8,["loading"])]),_:1},8,["title"])}}},lt=ie(ot,[["__scopeId","data-v-2f98d76d"]]),rt=["zh-CN","zh-TW","en-US","ja-JP"],fe={"zh-CN":{title_default:"入群验证",title_success:"验证成功",load_failed:"加载失败",verify_success_subtitle:"请在群内发送下方绑定码完成验证",expire_tip:"绑定码{minutes}分钟内有效，请及时使用。",copy_code:"复制绑定码",refresh_status:"刷新状态",steps:`1. 点击“开始验证”完成安全验证
2. 获取绑定码后，在群内发送即可`,start_verify:"开始验证",captcha_loading:"验证码加载中…",captcha_component_load_failed:"验证码组件加载失败，请刷新页面重试",captcha_init_failed:"验证码初始化失败，请刷新页面重试",please_complete_captcha:"请先完成验证",captcha_loading_wait:"验证码正在加载，请稍候…",captcha_error_refresh:"验证码出错，请刷新页面重试",verify_success:"验证成功",code_copied_paste:"绑定码已复制，可直接在群内粘贴发送",verify_failed_retry:"验证失败，请重试",network_error_retry:"网络异常，请稍后重试",code_copied:"绑定码已复制",copy_failed:"复制失败",copy_failed_manual_prefix:"请手动复制绑定码：",server_response_invalid:"服务器响应异常",link_expired_or_missing:"验证链接已过期或不存在",invalid_link:"无效的验证链接"},"zh-TW":{title_default:"入群驗證",title_success:"驗證成功",load_failed:"載入失敗",verify_success_subtitle:"請在群內發送下方綁定碼完成驗證",expire_tip:"綁定碼{minutes}分鐘內有效，請及時使用。",copy_code:"複製綁定碼",refresh_status:"重新整理狀態",steps:`1. 點擊「開始驗證」完成安全驗證
2. 取得綁定碼後，在群內發送即可`,start_verify:"開始驗證",captcha_loading:"驗證碼載入中…",captcha_component_load_failed:"驗證碼元件載入失敗，請重新整理頁面重試",captcha_init_failed:"驗證碼初始化失敗，請重新整理頁面重試",please_complete_captcha:"請先完成驗證",captcha_loading_wait:"驗證碼正在載入，請稍候…",captcha_error_refresh:"驗證碼發生錯誤，請重新整理頁面重試",verify_success:"驗證成功",code_copied_paste:"驗證碼已複製，可直接在群內貼上發送",verify_failed_retry:"驗證失敗，請重試",network_error_retry:"網路異常，請稍後重試",code_copied:"驗證碼已複製",copy_failed:"複製失敗",copy_failed_manual_prefix:"請手動複製綁定碼：",server_response_invalid:"伺服器回應異常",link_expired_or_missing:"驗證連結已過期或不存在",invalid_link:"無效的驗證連結"},"en-US":{title_default:"Group Verification",title_success:"Verified",load_failed:"Load failed",verify_success_subtitle:"Send the binding code below in the group to finish verification",expire_tip:"The binding code expires in {minutes} minutes.",copy_code:"Copy Binding Code",refresh_status:"Refresh",steps:`1. Click "Start Verification" to complete the challenge
2. Send the binding code in the group chat`,start_verify:"Start Verification",captcha_loading:"Loading…",captcha_component_load_failed:"Captcha script failed to load. Please refresh and try again.",captcha_init_failed:"Captcha initialization failed. Please refresh and try again.",please_complete_captcha:"Please complete the challenge first",captcha_loading_wait:"Captcha is loading, please wait…",captcha_error_refresh:"Captcha error. Please refresh and try again.",verify_success:"Verification succeeded",code_copied_paste:"Binding code copied. You can paste it into the group chat.",verify_failed_retry:"Verification failed. Please try again.",network_error_retry:"Network error. Please try again later.",code_copied:"Binding code copied",copy_failed:"Copy failed",copy_failed_manual_prefix:"Please copy the binding code manually: ",server_response_invalid:"Invalid server response",link_expired_or_missing:"This link is expired or does not exist",invalid_link:"Invalid link"},"ja-JP":{title_default:"グループ認証",title_success:"認証成功",load_failed:"読み込みに失敗しました",verify_success_subtitle:"下のバインドコードをグループに送信して認証を完了してください",expire_tip:"このバインドコードの有効期限は{minutes}分です。",copy_code:"バインドコードをコピー",refresh_status:"更新",steps:`1. 「認証開始」をクリックして認証を完了します
2. バインドコードをグループに送信してください`,start_verify:"認証開始",captcha_loading:"読み込み中…",captcha_component_load_failed:"Captcha の読み込みに失敗しました。ページを更新して再試行してください。",captcha_init_failed:"Captcha の初期化に失敗しました。ページを更新して再試行してください。",please_complete_captcha:"先に認証を完了してください",captcha_loading_wait:"Captcha を読み込み中です。しばらくお待ちください…",captcha_error_refresh:"Captcha エラー。ページを更新して再試行してください。",verify_success:"認証に成功しました",code_copied_paste:"バインドコードをコピーしました。グループに貼り付けて送信できます。",verify_failed_retry:"認証に失敗しました。再試行してください。",network_error_retry:"ネットワークエラー。しばらくしてから再試行してください。",code_copied:"バインドコードをコピーしました",copy_failed:"コピーに失敗しました",copy_failed_manual_prefix:"バインドコードを手動でコピーしてください：",server_response_invalid:"サーバー応答が不正です",link_expired_or_missing:"リンクの有効期限が切れているか存在しません",invalid_link:"無効なリンク"}};function ee(n){const e=String(n||"").trim();if(!e)return"zh-CN";const t=e.toLowerCase();return t==="zh-cn"||t==="zh-hans"||t==="zh"?"zh-CN":t==="zh-tw"||t==="zh-hant"||t==="zh-hk"||t==="zh-mo"?"zh-TW":t.startsWith("en")?"en-US":t.startsWith("ja")?"ja-JP":rt.find(i=>i.toLowerCase()===t)||"zh-CN"}function it(){if(typeof window>"u")return"";const n=new URLSearchParams(window.location.search||"");return n.get("lang")||n.get("locale")||""}function st(){if(typeof window>"u")return"";try{return window.localStorage.getItem("locale")||""}catch{return""}}function ut(n){if(!(typeof window>"u"))try{window.localStorage.setItem("locale",n)}catch{}}function ct(){if(typeof navigator>"u")return"zh-CN";const e=(Array.isArray(navigator.languages)?navigator.languages:[])[0]||navigator.language||"";return ee(e)}function dt(){const n=ee(it());if(n)return n;const e=ee(st());return e||ct()}function ft(n){const e=ee(n);return ut(e),typeof document<"u"&&document.documentElement&&(document.documentElement.lang=e),e}function pt(n){const e=ee(n);return e==="en-US"?Se:e==="ja-JP"?Ce:e==="zh-TW"?xe:Ae}function _t(n){return function(t,r){const i=ee(n());let k=(fe[i]||fe["zh-CN"])[t]||fe["zh-CN"][t]||t;return r&&typeof r=="object"&&Object.keys(r).forEach(m=>{k=k.replaceAll("{"+m+"}",String(r[m]))}),k}}const mt={class:"page"},vt={__name:"App",setup(n){const e=g(ft(dt())),t=V(()=>pt(e.value)),r=_t(()=>e.value),i=g(!1),c=g("");function k(){c.value=window.location.pathname||""}function m(_){const f=String(_||"/");(window.location.pathname||"")!==f&&(window.history.pushState({},"",f),k())}const x=V(()=>{const _=c.value||"";return _==="/admin/login"||_==="/admin/login/"?"login":"home"});function N(){m("/admin/login")}function S(){m("/admin")}return ae(()=>{i.value=Ze(),k(),window.addEventListener("popstate",k)}),(_,f)=>{const E=d("a-config-provider");return h(),A(E,{locale:t.value},{default:a(()=>[X("div",mt,[i.value?(h(),J(Q,{key:0},[x.value==="login"?(h(),A(Fe,{key:0,"on-login-success":S})):(h(),A(Qe,{key:1,"on-logout":N}))],64)):(h(),A(lt,{key:1,t:G(r)},null,8,["t"]))])]),_:1},8,["locale"])}}},yt=ie(vt,[["__scopeId","data-v-f9ffc9f2"]]);Te(yt,({app:n})=>{if(n.use(ze),typeof window<"u"&&window.matchMedia){const e=window.matchMedia("(prefers-color-scheme: dark)"),t=i=>{i?document.body.setAttribute("arco-theme","dark"):document.body.removeAttribute("arco-theme")};t(e.matches);const r=i=>t(i.matches);e.addEventListener?e.addEventListener("change",r):e.addListener&&e.addListener(r)}});
